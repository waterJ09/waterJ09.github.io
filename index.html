<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>婺畔的个人网页</title>
    <!-- Google Fonts: Cormorant Garamond (标题), Space Grotesk (正文), Patrick Hand (手写) -->
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;700&family=Space+Grotesk:wght@300;400;600&family=Patrick+Hand&display=swap" rel="stylesheet">
    <style>
        :root{
            --bg:#0b0b0b; /* 更深的基色 */
            --bg-mid:#2b2b2b; /* 中间灰色，用于平滑过渡 */
            --nav-height:72px;
            --ivory:#F8F5F0;
            --accent:#6D8AA3; /* 默认为莫兰迪蓝，可按需调整 */
            --muted:#BFBDB8;
            --gold:#D4AF37;
            --space-1:8px; --space-2:13px; --space-3:21px; --space-4:34px;
        }
        html,body{height:100%;scroll-behavior:smooth}
        body{
            margin:0;
            font-family:'Space Grotesk',system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial;
            /* 将页面主背景改为黑->灰的平滑渐变，避免突兀的黑白过渡 */
            background: linear-gradient(180deg,var(--bg) 0%, var(--bg-mid) 65%);
            color:var(--ivory);
            -webkit-font-smoothing:antialiased;
            -moz-osx-font-smoothing:grayscale;
            line-height:1.45;
        }
        a{color:inherit;text-decoration:none}
        .container{max-width:1200px;margin:0 auto;padding:calc(var(--space-3)*1.2);}

        /* NAV */
        .site-nav{position:fixed;left:0;right:0;top:0;height:var(--nav-height);display:flex;align-items:center;z-index:90;background:linear-gradient(180deg,rgba(26,26,26,0.35),rgba(26,26,26,0.08));backdrop-filter:blur(6px)}
        .site-nav .container{display:flex;align-items:center;justify-content:space-between;padding-left:calc(var(--space-3)*1.2);padding-right:calc(var(--space-3)*1.2)}
    /* 将品牌向左偏移并保留较大空隙（至少 200px） */
    .site-nav .brand{display:inline-block;margin-left:calc(-1 * (var(--space-3) * 1.2) + 200px);padding-left:16px}
        .nav-links{display:flex;gap:18px;align-items:center}
        .nav-links a{color:var(--ivory);opacity:0.9;padding:8px 10px;border-radius:6px;transition:background .18s}
        .nav-links a:hover{background:rgba(255,255,255,0.02)}

        /* HERO */
        .hero{
            min-height:calc(100vh - var(--nav-height));display:flex;align-items:center;justify-content:center;padding-top:40px;padding-bottom:40px;
            /* 让 hero 保持略深的起始色并平滑过渡到页面中段的灰色 */
            background: linear-gradient(180deg,var(--bg) 0%, rgba(43,43,43,0.85) 55%);
        }
        .hero-inner{display:flex;width:100%;gap:var(--space-4);align-items:center}
        .hero-left{flex:0 0 60%;padding:var(--space-3)}
        .hero-right{flex:0 0 40%;text-align:center;padding:var(--space-3)}
        h1.title{font-family:'Cormorant Garamond',serif;font-size:48px;margin:0;color:var(--ivory);}
        .subtitle{font-family:'Cormorant Garamond',serif;color:var(--muted);font-size:20px;margin-top:var(--space-2)}
        .typing{display:inline-block;border-right:2px solid rgba(248,245,240,0.15);padding-right:6px}

        /* portrait */
        .portrait{width:100%;max-width:360px;margin:0 auto}
        .portrait svg{width:100%;height:auto;filter:drop-shadow(0 6px 18px rgba(0,0,0,0.6));}

        /* social icons */
        .socials{display:flex;gap:var(--space-2);justify-content:center;margin-top:var(--space-3)}
        .icon{width:42px;height:42px;display:inline-flex;align-items:center;justify-content:center;border-radius:8px;background:rgba(255,255,255,0.03);transition:box-shadow .25s,transform .18s}
        .icon svg{fill:var(--ivory);opacity:0.9}
        .icon:hover{box-shadow:0 6px 18px rgba(109,138,163,0.18);transform:translateY(-4px)}

        /* ABOUT */
    /* 每个 section 使用自适应渐变背景，渐变的高度会随着内容高度自然扩展 */
    section{padding:var(--space-4) 0;background:linear-gradient(180deg, rgba(255,255,255,0.01) 0%, rgba(255,255,255,0.00) 28%, rgba(0,0,0,0.06) 100%);} 
    /* 避免 fixed nav 遮挡锚点 */
    section{scroll-margin-top:calc(var(--nav-height) + 16px)}
        .about{display:flex;gap:var(--space-4);align-items:flex-start}
        .about-left{flex:0 0 40%;font-family:'Patrick Hand',cursive;color:#CFCBC7;font-style:italic;font-size:20px;padding-right:var(--space-3)}
        .about-right{flex:1}
        .timeline{border-left:2px solid rgba(255,255,255,0.04);padding-left:var(--space-3)}
        .timeline-item{position:relative;padding:18px 0}
        .timeline-item::before{content:'';position:absolute;left:-11px;top:10px;width:14px;height:14px;border-radius:50%;background:var(--accent);box-shadow:0 0 0 4px rgba(109,138,163,0.07)}
        .tags{display:flex;flex-wrap:wrap;gap:8px;margin-top:var(--space-3)}
        .tag{background:rgba(255,255,255,0.04);padding:6px 10px;border-radius:999px;font-size:13px;cursor:pointer;transition:background .18s,transform .12s}
        .tag:hover{background:var(--accent);transform:translateY(-3px)}

        /* 软件技能按钮 */
        .skill-btn{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.03);color:var(--ivory);padding:8px 12px;border-radius:999px;cursor:pointer;font-weight:600}
        .skill-btn.active{background:var(--accent);border-color:var(--accent);box-shadow:0 6px 18px rgba(109,138,163,0.12)}

        /* PORTFOLIO: 瀑布流 */
        .portfolio-grid{column-count:3;column-gap:var(--space-3)}
        .card{break-inside:avoid;margin-bottom:var(--space-3);position:relative;cursor:pointer;overflow:hidden;border-radius:8px}
        .card .img{background-size:cover;background-position:center;height:220px}
        .card.large .img{height:420px}
        .card .overlay{position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,0,0,0.0),rgba(0,0,0,0.45));display:flex;flex-direction:column;justify-content:flex-end;padding:12px;opacity:0;transition:opacity .18s}
        .card:hover .overlay{opacity:1}
    .overlay .meta{font-size:13px;color:var(--ivory)}
    /* 隐藏卡片上的命名，按需可移除此规则 */
    .overlay .meta{display:none}

        /* modal */
        .modal{position:fixed;inset:0;background:rgba(0,0,0,0.8);display:none;align-items:center;justify-content:center;z-index:60;padding:40px}
        .modal.open{display:flex}
        .modal-inner{width:100%;max-width:1100px;background:linear-gradient(180deg,#111, #0f0f0f);border-radius:8px;display:flex;gap:20px;overflow:hidden}
        .modal-left{flex:1;background:#0b0b0b;padding:20px}
        .modal-left img{width:100%;height:auto;display:block}
        .modal-right{width:360px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);padding:20px;color:var(--muted)}
        .close-btn{position:absolute;right:28px;top:28px;color:var(--ivory);cursor:pointer;font-size:20px}

        /* CONTACT */
        .contact{background:linear-gradient(180deg,rgba(26,26,26,0.95),#0f0f10);text-align:center;padding:48px 0;border-top:1px solid rgba(255,255,255,0.03)}
        .contact .card{max-width:760px;margin:0 auto;padding:28px}
        .envelope{display:inline-block;margin-right:12px;vertical-align:middle;transition:transform .18s}
        .email{font-weight:600;color:var(--ivory)}
        .btn{display:inline-block;background:var(--gold);color:#1A1A1A;padding:10px 18px;border-radius:999px;margin-top:16px;cursor:pointer}
        .form{display:none;margin-top:var(--space-3);text-align:left}
        .form.active{display:block}
        .form input,.form textarea{width:100%;padding:10px;border-radius:6px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:var(--ivory);margin-bottom:10px}

        /* success particle canvas */
        #particleCanvas{position:fixed;pointer-events:none;left:0;top:0;width:100%;height:100%;z-index:70;mix-blend-mode:screen}

        /* responsive */
        @media(max-width:900px){
            .hero-inner{flex-direction:column}
            .hero-left,.hero-right{flex:1 1 100%}
            .portfolio-grid{column-count:2}
            .modal-inner{flex-direction:column}
            .modal-right{width:100%}
            .about{flex-direction:column}
            .site-nav .brand{margin-left:12px}
        }
        @media(max-width:600px){
            .portfolio-grid{column-count:1}
            h1.title{font-size:34px}
        }
    </style>
</head>
    <body>
    <!-- 固定导航 -->
    <nav class="site-nav" role="navigation" aria-label="主导航">
        <div class="container">
            <a class="brand" href="#home" style="font-family:'Cormorant Garamond',serif;font-size:18px;color:var(--ivory);text-decoration:none">婺畔</a>
            <div class="nav-links">
                <a href="#home">首页</a>
                <a href="#about">关于</a>
                <a href="#skills">技能</a>
                <a href="#portfolio">作品</a>
                <a href="#contact">联系</a>
            </div>
        </div>
    </nav>
    <main>
    <header id="home" class="hero">
            <div class="container hero-inner">
                <div class="hero-left">
                    <h1 class="title"> <span class="typing" id="typed"></span></h1>
                    <div class="subtitle" id="subtitle">Creating <span id="field">visual stories</span> with <span id="philosophy">intimate narratives</span></div>
                </div>
                <div class="hero-right">
                    <div class="portrait" aria-hidden="true">
                        <!-- 极简线条肖像 SVG 占位 -->
                        <svg viewBox="0 0 280 360" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="portrait placeholder">
                            <rect width="100%" height="100%" fill="transparent"/>
                            <g stroke="rgba(248,245,240,0.9)" stroke-width="2" fill="none">
                                <path d="M80 220c0-50 40-100 80-100s80 50 80 100" stroke-linecap="round" stroke-linejoin="round"/>
                                <circle cx="140" cy="90" r="46"/>
                                <path d="M100 290c20-8 40-12 60-12s40 4 60 12" stroke-linecap="round"/>
                                <path d="M95 235c10-6 20-10 45-12 25 2 35 6 50 12" stroke-linecap="round"/>
                            </g>
                        </svg>
                    </div>
                                        <div class="socials" role="navigation" aria-label="social links">
                                                <!-- 小红书 图标占位 -->
                                                <a class="icon" href="#" title="小红书">
                                                    <svg width="18" height="18" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                        <rect x="2" y="2" width="20" height="20" rx="4" fill="#E64646" />
                                                        <text x="50%" y="58%" font-size="10" text-anchor="middle" fill="#fff" font-family="sans-serif">小</text>
                                                    </svg>
                                                </a>
                                                <!-- 微信 图标占位 -->
                                                <a class="icon" href="#" title="微信">
                                                    <svg width="20" height="20" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                        <g fill="#20C05B">
                                                            <path d="M6 15c-1 0-2 .8-2 1.8V19h8c.6 0 1-.4 1-1v-.2c0-1-1-1.8-2-1.8H6z"/>
                                                            <path d="M17 7c-2.2 0-4 1.8-4 4 0 1.1.5 2.1 1.4 2.7L16 15l2-1c.8-.4 1.6-1.2 1.6-2.7 0-2.2-1.8-4-4-4z"/>
                                                        </g>
                                                    </svg>
                                                </a>
                                                <a class="icon" href="#" title="GitHub"><svg width="20" height="20" viewBox="0 0 24 24"><path d="M12 .5a12 12 0 0 0-3.8 23.4c.6.1.8-.2.8-.5v-2c-3.3.7-4-1.6-4-1.6-.5-1.2-1.3-1.5-1.3-1.5-1-.7.1-.7.1-.7 1.1.1 1.7 1.1 1.7 1.1 1 .1 1.6.7 1.9 1 .1-.8.4-1.4.8-1.7-2.6-.3-5.3-1.3-5.3-5.9 0-1.3.5-2.4 1.2-3.2-.1-.3-.5-1.6.1-3.4 0 0 1-.3 3.4 1.2a11 11 0 0 1 6.2 0C19 6 20 6.3 20 6.3c.6 1.8.2 3.1.1 3.4.8.8 1.2 2 1.2 3.2 0 4.6-2.7 5.6-5.3 5.9.4.3.7 1 .7 2v3c0 .3.2.6.8.5A12 12 0 0 0 12 .5z"/></svg></a>
                                        </div>
                </div>
            </div>
        </header>

        <section class="container about" id="about">
            <div class="about-left"></div>
                        <div class="about-right">
                                <p style="color:var(--muted);margin-bottom:8px">来自浙江金华，就读于浙江大学艺术与科技专业。</p>
                                <div class="tags" aria-label="tags">
                                        <div class="tag">#混合媒介</div>
                                        <div class="tag">#可持续创作</div>
                                        <div class="tag">#跨维度叙事</div>
                                </div>
                        </div>
        </section>

                <!-- 软件技能 区块 -->
                        <section class="container" id="skills">
                            <h2 style="font-family:'Cormorant Garamond',serif;margin-bottom:12px">软件技能</h2>
                                <div class="skills-grid" style="display:flex;flex-direction:row;gap:12px;flex-wrap:wrap;max-width:900px">
                                    <button class="skill-btn" data-skill="All">全部</button>
                                    <button class="skill-btn" data-skill="AI">AI</button>
                                    <button class="skill-btn" data-skill="Figma">Figma</button>
                                    <button class="skill-btn" data-skill="Rhino">Rhino</button>
                                </div>
                                <p id="skill-note" style="color:var(--muted);margin-top:12px">点击任一软件以在下方查看对应作品（不会改变“项目经历”区）。</p>
                                <!-- 预先填充的技能画廊：按文件夹将作品列出 -->
                                <div id="skills-gallery" class="portfolio-grid" style="margin-top:18px">
                                    <!-- AI 文件 -->
                                    <div class="card" data-title="海报" data-year="" data-media="PDF" data-desc="AI 海报" data-skill="AI">
                                        <a href="个人作品/ai/海报.pdf" target="_blank">
                                            <div class="img" style="background-image:url('bg.jpg')"></div>
                                        </a>
                                        <div class="overlay"><div class="meta">海报 · AI</div></div>
                                    </div>
                                    <!-- Figma 文件 -->
                                    <div class="card" data-title="排版" data-year="" data-media="PDF" data-desc="Figma 排版" data-skill="Figma">
                                        <a href="个人作品/figma/排版.pdf" target="_blank">
                                            <div class="img" style="background-image:url('bg.jpg')"></div>
                                        </a>
                                        <div class="overlay"><div class="meta">排版 · Figma</div></div>
                                    </div>
                                    <!-- Rhino 文件 -->
                                    <div class="card" data-title="01" data-year="" data-media="PDF" data-desc="Rhino 01" data-skill="Rhino"><a href="个人作品/rino/01.pdf" target="_blank"><div class="img" style="background-image:url('bg.jpg')"></div></a><div class="overlay"><div class="meta">01 · Rhino</div></div></div>
                                    <div class="card" data-title="S2" data-year="" data-media="PDF" data-desc="Rhino S2" data-skill="Rhino"><a href="个人作品/rino/S2.pdf" target="_blank"><div class="img" style="background-image:url('bg.jpg')"></div></a><div class="overlay"><div class="meta">S2 · Rhino</div></div></div>
                                    <div class="card" data-title="栅栏练习" data-year="" data-media="PDF" data-desc="Rhino 栅栏练习" data-skill="Rhino"><a href="个人作品/rino/栅栏练习.pdf" target="_blank"><div class="img" style="background-image:url('bg.jpg')"></div></a><div class="overlay"><div class="meta">栅栏练习 · Rhino</div></div></div>
                                    <div class="card" data-title="模块练习" data-year="" data-media="PDF" data-desc="Rhino 模块练习" data-skill="Rhino"><a href="个人作品/rino/模块练习.pdf" target="_blank"><div class="img" style="background-image:url('bg.jpg')"></div></a><div class="overlay"><div class="meta">模块练习 · Rhino</div></div></div>
                                </div>
                        </section>

        <section class="container" id="portfolio">
            <h2 style="font-family:'Cormorant Garamond',serif;margin-bottom:16px">项目经历</h2>
        <div class="portfolio-grid" id="grid">
                <!-- 将个人作品根目录中的内容放入项目经历 -->
            <div class="card" data-title="分镜" data-year="" data-media="PNG" data-desc="分镜图">
                <div class="img" style="background-image:url('个人作品/分镜.PNG')"></div>
                <div class="overlay"><div class="meta">分镜</div></div>
            </div>
            <div class="card" data-title="建模扫描练习" data-year="" data-media="PDF" data-desc="建模扫描练习">
                <a href="个人作品/建模扫描练习.pdf" target="_blank"><div class="img" style="background-image:url('bg.jpg')"></div></a>
                <div class="overlay"><div class="meta">建模扫描练习</div></div>
            </div>
            <div class="card" data-title="摄影1" data-year="" data-media="JPG" data-desc="摄影集1">
                <div class="img" style="background-image:url('个人作品/摄影1.jpg')"></div>
                <div class="overlay"><div class="meta">摄影1</div></div>
            </div>
            <div class="card" data-title="摄影2" data-year="" data-media="JPG" data-desc="摄影集2">
                <div class="img" style="background-image:url('个人作品/摄影2.jpg')"></div>
                <div class="overlay"><div class="meta">摄影2</div></div>
            </div>
            <div class="card" data-title="摄影3" data-year="" data-media="JPG" data-desc="摄影集3">
                <div class="img" style="background-image:url('个人作品/摄影3.jpg')"></div>
                <div class="overlay"><div class="meta">摄影3</div></div>
            </div>
            <div class="card" data-title="摄影4" data-year="" data-media="JPG" data-desc="摄影集4">
                <div class="img" style="background-image:url('个人作品/摄影4.jpg')"></div>
                <div class="overlay"><div class="meta">摄影4</div></div>
            </div>
            <div class="card" data-title="设计构成" data-year="" data-media="JPG" data-desc="设计构成">
                <div class="img" style="background-image:url('个人作品/设计构成.jpg')"></div>
                <div class="overlay"><div class="meta">设计构成</div></div>
            </div>
        </div>
        </section>

        <!-- modal -->
        <div class="modal" id="modal" aria-hidden="true">
            <div class="modal-inner">
                <div class="modal-left" id="modal-left">
                    <span class="close-btn" id="closeBtn">✕</span>
                    <img id="modal-img" src="" alt="作品放大图" style="display:block;max-height:80vh;object-fit:contain">
                    <iframe id="modal-embed" src="" style="display:none;width:100%;height:80vh;border:none;background:#000"></iframe>
                </div>
                <aside class="modal-right" id="modal-right">
                    <h3 id="m-title" style="color:var(--ivory);font-family:'Cormorant Garamond',serif"></h3>
                    <p id="m-year"></p>
                    <p id="m-media"></p>
                    <div style="height:1px;background:rgba(255,255,255,0.03);margin:12px 0"></div>
                    <div id="m-desc" style="font-size:14px;color:var(--muted)"></div>
                </aside>
            </div>
        </div>

        <section class="contact" id="contact">
            <div class="container">
                <div class="card">
                    <h2 style="font-family:'Cormorant Garamond',serif;margin:0 0 8px 0">致访客的一封信</h2>
                    <p style="color:var(--muted);max-width:760px;margin:0 auto">每个作品都在等待它的知音。如果你愿意聊聊合作、展览，或只是想说声‘你好’，我都非常期待。</p>
                    <div style="margin-top:16px;">
                        <span class="envelope" id="envIcon">✉️</span>
                        <a class="email" href="mailto:contact@yourdomain.com">contact@yourdomain.com</a>
                    </div>
                    <div>
                        <button class="btn" id="bookBtn">预约咨询</button>
                    </div>
                    <form class="form" id="contactForm">
                        <input type="text" id="name" placeholder="姓名" required />
                        <input type="email" id="email" placeholder="邮箱" required />
                        <textarea id="message" rows="4" placeholder="需求简述"></textarea>
                        <button type="submit" class="btn">发送</button>
                    </form>
                </div>
            </div>
        </section>

    </main>

    <canvas id="particleCanvas" aria-hidden="true"></canvas>

    <script>
        /* --- 简易一次性打字效果（只播放一次），使用 Array.from 支持中文字符逐字出现 --- */
        (function(){
            const el = document.getElementById('typed');
            const name = "婺畔"; // 已替换为指定名字
            const base = "Hello, I'm ";
            const chars = Array.from(base + name);
            let i = 0;
            function step(){
                i++;
                el.textContent = chars.slice(0,i).join('');
                if(i < chars.length) setTimeout(step, 80);
                else { el.classList.remove('typing'); }
            }
            // 从空开始打字（短暂延迟）
            setTimeout(step, 300);
        })();

        /* subtitle 替换示例文字为更具表现力的片段（可扩展） */
        (function(){
            const fields=['visual stories','poetic imagery','immersive narratives'];
            const ph=['Weaving emotions into visual stories','Echoing silence and color'];
            let fi=0; setInterval(()=>{document.getElementById('field').textContent=fields[fi%fields.length];document.getElementById('philosophy').textContent=ph[fi%ph.length]||'intimate narratives';fi++;},4200);
        })();

        /* --- Modal 展示 --- */
        const modal = document.getElementById('modal');
        const modalImg = document.getElementById('modal-img');
        const modalEmbed = document.getElementById('modal-embed');
        const mTitle = document.getElementById('m-title');
        const mYear = document.getElementById('m-year');
        const mMedia = document.getElementById('m-media');
        const mDesc = document.getElementById('m-desc');
        const closeBtn = document.getElementById('closeBtn');

        // 通用绑定函数：为某个作品卡绑定打开模态所需的事件
        function attachModalHandler(elem){
            elem.addEventListener('click', (e)=>{
                // 如果内部有链接到 PDF 或外部文档，优先在新标签打开
                const a = elem.querySelector('a');
                if(a){
                    const href = a.getAttribute('href')||'';
                    if(/\.pdf$/i.test(href)){
                        // 在模态中嵌入 PDF（替代新标签），更直观
                        e.preventDefault();
                        mTitle.textContent = elem.dataset.title || '';
                        mYear.textContent = elem.dataset.year || '';
                        mMedia.textContent = elem.dataset.media || '';
                        mDesc.textContent = elem.dataset.desc || '';
                        if(modalImg) modalImg.style.display = 'none';
                        if(modalEmbed){ modalEmbed.src = href; modalEmbed.style.display = 'block'; }
                        modal.classList.add('open'); modal.setAttribute('aria-hidden','false');
                        return;
                    }
                    if(/\.(jpe?g|png|gif|webp)$/i.test(href)){
                        e.preventDefault();
                        // 使用链接图片作为全图
                        mTitle.textContent = elem.dataset.title || '';
                        mYear.textContent = elem.dataset.year || '';
                        mMedia.textContent = elem.dataset.media || '';
                        mDesc.textContent = elem.dataset.desc || '';
                            if(modalEmbed){ modalEmbed.src=''; modalEmbed.style.display='none'; }
                            if(modalImg){ modalImg.style.display='block'; modalImg.src = href; }
                            modal.classList.add('open'); modal.setAttribute('aria-hidden','false');
                        return;
                    }
                }

                // 否则尝试从背景图中提取 URL
                const imgDiv = elem.querySelector('.img');
                let bgUrl = '';
                if(imgDiv){
                    const bg = getComputedStyle(imgDiv).backgroundImage || '';
                    const m = bg.match(/url\(["']?(.*?)["']?\)/);
                    if(m && m[1]) bgUrl = m[1];
                }
                if(bgUrl){
                    mTitle.textContent = elem.dataset.title || '';
                    mYear.textContent = elem.dataset.year || '';
                    mMedia.textContent = elem.dataset.media || '';
                    mDesc.textContent = elem.dataset.desc || '';
                    if(modalEmbed){ modalEmbed.src=''; modalEmbed.style.display='none'; }
                    if(modalImg){ modalImg.style.display='block'; modalImg.src = bgUrl; }
                    modal.classList.add('open'); modal.setAttribute('aria-hidden','false');
                    return;
                }

                // 回退：如果没有图像，也打开一个占位 SVG
                const title = elem.dataset.title || '';
                const year = elem.dataset.year || '';
                const media = elem.dataset.media || '';
                const desc = elem.dataset.desc || '';
                mTitle.textContent = title; mYear.textContent = year; mMedia.textContent = media; mDesc.textContent = desc;
                modalImg.src = 'data:image/svg+xml;utf8,'+encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="800"><rect width="100%" height="100%" fill="#111"/><text x="50%" y="50%" fill="#aaa" font-size="28" text-anchor="middle">'+title+' ('+year+')</text></svg>');
                modal.classList.add('open'); modal.setAttribute('aria-hidden','false');
            });
        }

        // 为页面内现有作品卡绑定模态处理器
        const originalCards = document.querySelectorAll('.portfolio-grid .card');
        originalCards.forEach(c=>attachModalHandler(c));

        // PDF 缩略图自动替换：如有同名 jpg 则用作预览，否则保持原逻辑
        originalCards.forEach(c=>{
            const imgDiv = c.querySelector('.img');
            if(!imgDiv) return;
            const bg = getComputedStyle(imgDiv).backgroundImage || '';
            const a = c.querySelector('a');
            let src = '';
            if(a){
                const href = a.getAttribute('href')||'';
                if(/\.pdf$/i.test(href)){
                    // 检查是否有同名 jpg
                    let thumb = '';
                    // 只处理 rino/ 下的 PDF
                    if(href.startsWith('个人作品/rino/')){
                        const base = href.replace(/\.pdf$/i,'');
                        thumb = base + '_page-0001.jpg';
                    }
                    // 预览图存在则替换
                    if(thumb && [
                        '个人作品/rino/01_page-0001.jpg',
                        '个人作品/rino/S2_page-0001.jpg',
                        '个人作品/rino/模块练习_page-0001.jpg'
                    ].includes(thumb)){
                        src = thumb;
                    }
                } else if(/\.(jpe?g|png|gif|webp)$/i.test(href)){
                    src = href;
                }
            }
            if(src){
                imgDiv.style.backgroundImage = `url('${src}')`;
            } else {
                // 如果当前背景为 bg.jpg 或 linear-gradient 或 空，则替换为随机图片
                if(/bg\.jpg|gradient|none|linear-gradient/i.test(bg) || bg.trim()===''){
                    const seed = encodeURIComponent((c.dataset.title||Math.random()).slice(0,20));
                    imgDiv.style.backgroundImage = `url('https://picsum.photos/seed/${seed}/800/600')`;
                }
            }
        });

        function closeModal(){
            modal.classList.remove('open');
            modal.setAttribute('aria-hidden','true');
            // 清理 embed，防止继续占用资源或播放 PDF
            if(modalEmbed){ modalEmbed.src = ''; modalEmbed.style.display = 'none'; }
            if(modalImg){ modalImg.src = ''; modalImg.style.display = 'block'; }
        }
        closeBtn.addEventListener('click', closeModal);
        modal.addEventListener('click',(e)=>{if(e.target===modal) { closeModal(); }});

        /* --- Contact 表单与粒子动画 --- */
        const bookBtn = document.getElementById('bookBtn');
        const form = document.getElementById('contactForm');
        const envIcon = document.getElementById('envIcon');
        bookBtn.addEventListener('click',()=>{form.classList.toggle('active');if(form.classList.contains('active')){document.getElementById('name').focus();}});
        document.querySelector('.email').addEventListener('mouseenter',()=>{envIcon.style.transform='translateY(-6px)';});
        document.querySelector('.email').addEventListener('mouseleave',()=>{envIcon.style.transform='translateY(0)';});

        // 粒子画布
        const canvas = document.getElementById('particleCanvas');
        const ctx = canvas.getContext('2d');
        function resizeCanvas(){canvas.width=window.innerWidth;canvas.height=window.innerHeight;} resizeCanvas(); window.addEventListener('resize',resizeCanvas);
        function emitParticles(x,y){
            const particles = [];
            for(let i=0;i<60;i++){particles.push({x,y, vx:(Math.random()-0.5)*6, vy:(Math.random()-1.8)*6, life:Math.random()*60+30, r:Math.random()*2+1});}
            let t=0; const id = setInterval(()=>{ctx.clearRect(0,0,canvas.width,canvas.height); for(let p of particles){p.x+=p.vx; p.y+=p.vy; p.vy+=0.12; p.life--; ctx.beginPath(); ctx.fillStyle='rgba(212,175,55,'+Math.max(p.life/80,0)+')'; ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill();} t++; if(particles.every(p=>p.life<=0)){clearInterval(id);ctx.clearRect(0,0,canvas.width,canvas.height);} },16);
        }

        form.addEventListener('submit',function(e){e.preventDefault(); // 前端模拟成功提交
            const rect = bookBtn.getBoundingClientRect(); emitParticles(rect.left+rect.width/2, rect.top+10);
            form.reset(); form.classList.remove('active');
            // 简短提示
            const old = bookBtn.textContent; bookBtn.textContent='已发送 ✓'; setTimeout(()=>bookBtn.textContent=old,2200);
        });

                /* --- 软件技能展示（单独区域：#skills-gallery，与主作品/项目经历不联动） --- */
                (function(){
                    const buttons = document.querySelectorAll('.skill-btn');
                    const gallery = document.getElementById('skills-gallery');
                    const sourceCards = Array.from(gallery.querySelectorAll('.card'));
                    const noteEl = document.getElementById('skill-note');

                    function clearPlaceholders(){ const ph = gallery.querySelectorAll('.card.empty'); ph.forEach(p=>p.remove()); }
                    function showAll(){ clearPlaceholders(); sourceCards.forEach(c=>c.style.display='block'); noteEl.textContent = '显示全部技能作品（不会改变项目经历）'; }

                    function showForSkill(skill){
                        clearPlaceholders();
                        const matched = sourceCards.filter(c=>{
                            const s = (c.dataset.skill || c.dataset.skills || '');
                            return s.split(',').map(x=>x.trim()).includes(skill);
                        });
                        sourceCards.forEach(c=>c.style.display='none');
                        if(matched.length===0){
                            // 如果没有作品，显示两个空占位卡
                            for(let i=0;i<2;i++){
                                const empty = document.createElement('div'); empty.className='card empty';
                                empty.innerHTML = '<div class="img" style="background-image:url(\'bg.jpg\')"></div><div class="overlay"><div class="meta">空照片</div></div>';
                                gallery.appendChild(empty);
                            }
                            noteEl.textContent = '未找到对应作品，显示占位。';
                            return;
                        }
                        matched.forEach(c=>c.style.display='block');
                        noteEl.textContent = `正在显示使用 ${skill} 的作品`;
                    }

                    buttons.forEach(b=>{
                        b.addEventListener('click',()=>{
                            buttons.forEach(x=>x.classList.remove('active'));
                            b.classList.add('active');
                            const skill = b.dataset.skill;
                            if(skill==='All') showAll(); else showForSkill(skill);
                        });
                    });
                    // 默认显示全部（但不影响项目经历）
                    const allBtn = document.querySelector('.skill-btn[data-skill="All"]'); if(allBtn) allBtn.classList.add('active');
                    showAll();
                })();

        /* small accessibility: keyboard close modal */
        document.addEventListener('keydown',e=>{ if(e.key==='Escape'){ modal.classList.remove('open'); modal.setAttribute('aria-hidden','true'); } });

    </script>
</body>
</html>
